{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Material Did√°ctico - Profesor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #eef3ff;
      font-family: 'Poppins', sans-serif;
    }

    .header {
      background: linear-gradient(135deg, #0d6efd, #6c63ff);
      color: white;
      text-align: center;
      padding: 25px 0;
      border-radius: 0 0 20px 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .header h2 {
      font-weight: 700;
      font-size: 2rem;
    }

    .card {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      padding: 25px;
      margin-top: 25px;
    }

    .btn-primary {
      border-radius: 10px;
      background-color: #0d6efd;
      border: none;
      font-weight: 500;
      transition: 0.2s;
    }

    .btn-primary:hover {
      background-color: #0849b3;
    }

    .btn-warning {
      border-radius: 10px;
      font-weight: 500;
      color: #000;
    }

    .btn-danger, .btn-info {
      border-radius: 10px;
      font-weight: 500;
    }

    .btn-back {
      background-color: #6c757d;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      text-decoration: none;
      transition: 0.2s;
    }

    .btn-back:hover {
      background-color: #495057;
      color: #fff;
    }

    table th {
      background-color: #0d6efd;
      color: white;
      text-align: center;
    }

    table td {
      text-align: center;
      vertical-align: middle;
    }

    .alert {
      font-weight: 500;
      text-align: center;
    }

    .icono-tipo {
      font-size: 1.4rem;
      margin-right: 8px;
    }

    .icon-pdf { color: #dc3545; }
    .icon-video { color: #198754; }
    .icon-presentacion { color: #fd7e14;}
    .icon-doc { color: #0d6efd; }
    .icon-enlace { color: #6f42c1; }
    .icon-otro { color: #6c757d; }
  </style>
</head>
<body>

  <!-- Encabezado -->
  <div class="header">
    <h2>üìò Material Did√°ctico</h2>
    <p>Administra tus recursos y comp√°rtelos con tus estudiantes</p>
  </div>

  <div class="container mt-4">

    <!-- Mensajes -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-success">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <!-- Subir nuevo material -->
    <div class="card">
      <h4 class="mb-3">üì§ Subir nuevo material</h4>

      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="mb-3">
          <label for="titulo" class="form-label">T√≠tulo</label>
          {{ form.titulo }}
        </div>

        <div class="mb-3">
          <label class="form-label"><strong>Curso asociado</strong></label>
          <select name="curso" class="form-select">
            <option value="">Selecciona un curso...</option>
            {% for curso in cursos %}
              <option value="{{ curso.id }}">{{ curso.nombre }}</option>
            {% empty %}
              <option disabled>No tienes cursos creados.</option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-3">
          <label for="archivo" class="form-label">Archivo (opcional)</label>
          {{ form.archivo }}
        </div>

        <div class="mb-3">
          <label for="enlace" class="form-label">Enlace (opcional)</label>
          {{ form.enlace }}
        </div>

        <button type="submit" class="btn btn-primary mt-2">üíæ Guardar material</button>
      </form>
    </div>

    <!-- Lista de materiales -->
    <div class="card mt-4">
      <h4 class="mb-3">üìö Materiales subidos</h4>

      {% if materiales %}
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th>T√≠tulo</th>
            <th>Tipo</th>
            <th>Curso</th>
            <th>Archivo / Enlace</th>
            <th>Fecha de subida</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for material in materiales %}
          <tr>
            <td>{{ material.titulo }}</td>
            <td>
              {% if material.tipo == "PDF" %}
                <span class="icono-tipo icon-pdf">üìÑ</span> PDF
              {% elif material.tipo == "Video" %}
                <span class="icono-tipo icon-video">üé•</span> Video
              {% elif material.tipo == "Presentaci√≥n" %}
                <span class="icono-tipo icon-presentacion">üìä</span> Presentaci√≥n
              {% elif material.tipo == "Documento" %}
                <span class="icono-tipo icon-doc">üìù</span> Documento
              {% elif material.tipo == "Enlace" %}
                <span class="icono-tipo icon-enlace">üîó</span> Enlace
              {% else %}
                <span class="icono-tipo icon-otro">üìÅ</span> Otro
              {% endif %}
            </td>

            <!-- Nueva columna: Curso -->
            <td>
              {% if material.curso %}
                <span class="badge bg-primary">{{ material.curso.nombre }}</span>
              {% else %}
                <span class="text-muted">Sin curso</span>
              {% endif %}
            </td>

            <td>
              {% if material.archivo %}
                <a href="{{ material.archivo.url }}" target="_blank">üìé Ver archivo</a>
              {% elif material.enlace %}
                <a href="{{ material.enlace }}" target="_blank">üîó Ver enlace</a>
              {% else %}
                Sin archivo/enlace
              {% endif %}
            </td>

            <td>{{ material.fecha_subida|date:"d/m/Y H:i" }}</td>

            <td>
              <a href="{% url 'dashboard:editar_material' material.id %}" class="btn btn-warning btn-sm">‚úèÔ∏è Editar</a>
              <a href="{% url 'dashboard:eliminar_material' material.id %}" class="btn btn-danger btn-sm">üóëÔ∏è Eliminar</a>

              {% if not material.curso %}
                <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#asignarModal{{ material.id }}">
                  üìé Asignar curso
                </button>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Modales para asignar curso -->
      {% for material in materiales %}
        {% if not material.curso %}
        <div class="modal fade" id="asignarModal{{ material.id }}" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">üìò Asignar curso a "{{ material.titulo }}"</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
              </div>
              <form method="post" action="{% url 'dashboard:asignar_material_a_curso' material.id %}">
                {% csrf_token %}
                <div class="modal-body">
                  <label class="form-label">Selecciona un curso:</label>
                  <select name="curso" class="form-select" required>
                    <option value="">-- Selecciona --</option>
                    {% for curso in cursos %}
                      <option value="{{ curso.id }}">{{ curso.nombre }}</option>
                    {% empty %}
                      <option disabled>No tienes cursos creados a√∫n.</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                  <button type="submit" class="btn btn-success">‚úÖ Asignar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        {% endif %}
      {% endfor %}

      {% else %}
        <p class="text-center text-muted">A√∫n no has subido materiales.</p>
      {% endif %}
    </div>

    <!-- Bot√≥n volver -->
    <div class="text-center my-4">
      <a href="{% url 'dashboard_profesor' %}" class="btn-back">‚¨Ö Volver al dashboard</a>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
